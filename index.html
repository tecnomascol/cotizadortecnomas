<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tecno+ | Arma tu cotización</title>
  <meta name="description" content="Landing Tecno+ para armar cotización: precios por medio de pago y envío por WhatsApp." />
  <style>
    :root{--negro:#0b0b0b;--negro-2:#141414;--gris:#101010;--borde:#222;--blanco:#fff;--texto:#e6e6e6;--muted:#bdbdbd;--rojo:#e60000;--rojo-2:#b00000;--ok:#2ecc71}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Roboto,Arial,sans-serif;background:#000;color:var(--texto);line-height:1.45}
    .container{max-width:1200px;margin:auto;padding:0 16px}
    .navbar{position:sticky;top:0;z-index:30;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--borde)}
    .brand{display:flex;align-items:center;gap:.6rem}
    .brand-logo{width:36px;height:36px;border-radius:10px;background:radial-gradient(70% 60% at 50% 40%, rgba(230,0,0,.3), transparent 60%),linear-gradient(135deg,#1a1a1a,#0c0c0c);display:grid;place-items:center}
    .brand-title{font-weight:700}
    .filters{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin:16px 0}
    select,input,button{background:#0f0f0f;color:var(--texto);border:1px solid var(--borde);border-radius:8px;padding:10px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--borde);padding:10px;text-align:left}
    .ok{color:var(--ok)}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header class="navbar">
    <div class="brand">
      <div class="brand-logo">🛒</div>
      <div class="brand-title">Tecno+ Cotizador</div>
    </div>
    <div class="muted">Inventario en vivo</div>
  </header>

  <main class="container">
    <section class="filters">
      <div>
        <label for="medio">Medio de pago</label>
        <select id="medio">
          <!-- Por requerimiento: solo 'sistecredito' disponible -->
          <option value="sistecredito" selected>Sistecredito</option>
        </select>
      </div>
      <div>
        <label for="busqueda">Buscar</label>
        <input id="busqueda" placeholder="Buscar por nombre o referencia" />
      </div>
      <div>
        <label for="categoria">Categoría</label>
        <select id="categoria">
          <option value="todas" selected>Todas</option>
        </select>
      </div>
    </section>

    <section>
      <table id="tabla">
        <thead>
          <tr>
            <th>Referencia</th>
            <th>Producto</th>
            <th>Stock</th>
            <th>Precio Sistecredito</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="vacio" class="muted" style="display:none;padding:12px">Sin resultados</div>
    </section>
  </main>

  <script>
    // Catálogo único y consistente con 'sistecredito'. Se eliminan referencias a 'brilla'
    const MEDIO_UNICO = 'sistecredito';

    // Ejemplo de catálogo; integrar el catálogo real aquí o mantener fetch desde inventario
    // Estructura esperada: { id, ref, nombre, categoria, stock, precios: { sistecredito: number } }
    let CATALOGO = [];

    // Intentar cargar catálogo desde inventario.html si existe un script JSON embebido
    async function cargarCatalogo() {
      try {
        const res = await fetch('inventario.json');
        if (res.ok) {
          const data = await res.json();
          // Normalizar claves de medio de pago: forzar 'sistecredito'
          CATALOGO = (data || []).map(x => normalizeItem(x));
          return;
        }
      } catch(e) {}
      // Fallback: intentar leer inventario.html y extraer JSON si viene embebido
      try {
        const res2 = await fetch('inventario.html');
        if (res2.ok) {
          const html = await res2.text();
          const match = html.match(/<script id="inventario"[^>]*>([\s\S]*?)<\/script>/);
          if (match) {
            const raw = JSON.parse(match[1]);
            CATALOGO = raw.map(x => normalizeItem(x));
            return;
          }
        }
      } catch(e) {}
      // Último recurso: catálogo vacío
      CATALOGO = [];
    }

    function normalizeItem(item) {
      const precios = item.precios || item.precio || {};
      // Consolidar: aceptar variantes mal escritas y mapear a 'sistecredito'
      const valor = precios.sistecredito ?? precios.sisecredito ?? precios.Sistecredito ?? precios.SISECREDITO ?? null;
      return {
        id: item.id ?? item.ref ?? crypto.randomUUID(),
        ref: (item.ref || '').toString(),
        nombre: item.nombre || item.name || 'Producto',
        categoria: item.categoria || item.category || 'general',
        stock: Number(item.stock ?? item.qty ?? 0),
        precios: { sistecredito: Number(valor ?? 0) }
      }
    }

    // UI helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function renderCategorias() {
      const cats = ['todas', ...new Set(CATALOGO.map(x => x.categoria))];
      const sel = $('#categoria');
      sel.innerHTML = cats.map(c => `<option value="${c}">${capitalize(c)}</option>`).join('');
      sel.value = 'todas';
    }

    function capitalize(s){return (s||'').charAt(0).toUpperCase()+ (s||'').slice(1)}

    function filtrarListado() {
      const q = $('#busqueda').value.trim().toLowerCase();
      const cat = $('#categoria').value;
      let res = CATALOGO.filter(x => x.precios && typeof x.precios[MEDIO_UNICO] === 'number');
      if (q) res = res.filter(x => x.nombre.toLowerCase().includes(q) || x.ref.toLowerCase().includes(q));
      if (cat && cat !== 'todas') res = res.filter(x => x.categoria === cat);
      return res;
    }

    function renderTabla() {
      const datos = filtrarListado();
      const tbody = $('#tabla tbody');
      tbody.innerHTML = datos.map(x => `
        <tr>
          <td>${x.ref || '-'}</td>
          <td>${escapeHtml(x.nombre)}</td>
          <td>${x.stock}</td>
          <td>${formatMoney(x.precios[MEDIO_UNICO])}</td>
          <td><button data-id="${x.id}" class="btn-add">Agregar</button></td>
        </tr>
      `).join('');
      $('#vacio').style.display = datos.length ? 'none':'block';
      bindAdd();
    }

    function bindAdd(){
      $$('#tabla .btn-add').forEach(btn => btn.onclick = () => {
        const id = btn.getAttribute('data-id');
        const prod = CATALOGO.find(p => p.id === id);
        if (!prod) return;
        addToCart(prod);
      });
    }

    function escapeHtml(str){return (str||'').replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]))}
    function formatMoney(n){return new Intl.NumberFormat('es-CO',{style:'currency',currency:'COP',maximumFractionDigits:0}).format(Number(n||0))}

    // Carrito
    const STORAGE_KEY = 'tecnoplus_cart_tabla_v2';
    function readCart(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY))||[]}catch(e){return []}}
    function writeCart(v){localStorage.setItem(STORAGE_KEY,JSON.stringify(v))}
    function addToCart(item){
      const cart = readCart();
      const i = cart.findIndex(x => x.id === item.id);
      if (i>=0){cart[i].qty = (cart[i].qty||0)+1}
      else {cart.push({id:item.id,ref:item.ref,nombre:item.nombre,precio:item.precios[MEDIO_UNICO],qty:1})}
      writeCart(cart);
      alert('Agregado al carrito');
    }

    // Eventos
    $('#busqueda')?.addEventListener('input', renderTabla);
    $('#categoria')?.addEventListener('change', renderTabla);

    // Init
    (async function init(){
      await cargarCatalogo();
      renderCategorias();
      renderTabla();
    })();
  </script>
</body>
</html>
